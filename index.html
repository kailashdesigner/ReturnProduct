<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Return Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- Barcode Library -->
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
:root {
  --primary:#2563eb;
  --success:#16a34a;
  --danger:#dc2626;
  --bg:#f4f6f8;
  --card:#ffffff;
}

* {
  box-sizing: border-box;
  font-family: system-ui, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  padding: 12px;
}

/* TOP INPUT */
.scan-input {
  display: flex;
  align-items: center;
  background: var(--card);
  border-radius: 12px;
  padding: 10px 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,.08);
}

.scan-input input {
  flex: 1;
  border: none;
  outline: none;
  font-size: 16px;
  padding: 8px;
}

.icon {
  color: #555;
  cursor: pointer;
}

/* SCANNER */
#scanner {
  display: none;
  margin-top: 12px;
  border-radius: 12px;
  overflow: hidden;
}

/* OPTIONS */
.options {
  margin-top: 14px;
  background: var(--card);
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,.06);
}

.options select {
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 15px;
}

/* RESULT */
.result {
  margin-top: 14px;
  background: var(--card);
  border-radius: 12px;
  padding: 14px;
  font-weight: 600;
  text-align: center;
  display: none;
}

/* COUNT */
.counter {
  margin-top: 14px;
  text-align: center;
  font-size: 15px;
  font-weight: 600;
}
</style>
</head>

<body>

<!-- TOP INPUT -->
<div class="scan-input">
  <span class="material-icons icon">qr_code</span>
  <input id="manualInput" type="text" placeholder="Scan or enter barcode">
  <span class="material-icons icon" onclick="toggleCamera()">photo_camera</span>
</div>

<!-- CAMERA -->
<div id="scanner"></div>

<!-- OPTIONS -->
<div class="options">
  <select>
    <option>Return Platform</option>
    <option>Meesho</option>
    <option>Flipkart</option>
    <option>Amazon</option>
  </select>

  <select>
    <option>Delivery Partner</option>
    <option>Xpressbees</option>
    <option>Flipkart Logistics</option>
    <option>Amazon</option>
    <option>Delhivery</option>
    <option>Shadowfax</option>
    <option>Volmo</option>
  </select>

  <select>
    <option>What We Received</option>
    <option>Cloth</option>
    <option>Missing Items</option>
  </select>
</div>

<!-- SCAN RESULT -->
<div id="result" class="result"></div>

<!-- COUNT -->
<div class="counter">
  Total Scans: <span id="count">0</span>
</div>

<script>
    let cameraOpen = false;
    let scanCount = 0;
    let html5QrCode;
    let lastScan = "";
    
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzRarWl5G1KQuivPkEX3a-Q5377-3I5HBb_ezRtDTKTc3836W1rsNt5a-Q5niPxOQw/exec";
    
    /* Toggle Camera */
    function toggleCamera() {
      const scannerDiv = document.getElementById("scanner");
    
      if (!cameraOpen) {
        scannerDiv.style.display = "block";
        startScanner();
      } else {
        stopScanner();
        scannerDiv.style.display = "none";
      }
    
      cameraOpen = !cameraOpen;
    }
    
    /* Start Scanner */
    function startScanner() {
      html5QrCode = new Html5Qrcode("scanner");
    
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        onScanSuccess
      );
    }
    
    /* Stop Scanner */
    function stopScanner() {
      if (html5QrCode) {
        html5QrCode.stop().catch(() => {});
      }
    }
    
    /* Scan Success */
    function onScanSuccess(decodedText) {
      if (decodedText === lastScan) return;
      lastScan = decodedText;
    
      scanCount++;
      document.getElementById("count").innerText = scanCount;
      document.getElementById("manualInput").value = decodedText;
    
      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerText =
        "Scanned & Saved: " + decodedText;
    
      sendToSheet(decodedText);
    
      stopScanner();
      cameraOpen = false;
    }
    
    /* Send to Google Sheet */
    function sendToSheet(code) {
  const payload = {
    platform: document.querySelectorAll("select")[0].value,
    partner: document.querySelectorAll("select")[1].value,
    received: document.querySelectorAll("select")[2].value,
    awb: code,
    packet: "",
    sku: ""
  };

  fetch(SCRIPT_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(res => {
    console.log("Sheet response:", res);
  })
  .catch(err => {
    console.error("Fetch error:", err);
  });
}

    </script>
    

</body>
</html>


